<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/cliniquedigitale/cliniquedigitale/util/JPAUtil.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/cliniquedigitale/cliniquedigitale/util/JPAUtil.java" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.cliniquedigitale.cliniquedigitale.util;&#10;&#10;// Squelette utilitaire JPA (laisser vide pour l'instant)&#10;public final class JPAUtil {&#10;    private JPAUtil() {}&#10;    // TODO: ajouter EntityManagerFactory et méthodes plus tard&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/webapp/WEB-INF/view/patient/doctor-availability.jsp">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/webapp/WEB-INF/view/patient/doctor-availability.jsp" />
              <option name="originalContent" value="&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&#10;&lt;%@ taglib uri=&quot;jakarta.tags.core&quot; prefix=&quot;c&quot; %&gt;&#10;&lt;%@ taglib uri=&quot;jakarta.tags.functions&quot; prefix=&quot;fn&quot; %&gt;&#10;&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;fr&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;title&gt;Disponibilités - ${doctor.user.name}&lt;/title&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;&#10;    &lt;style&gt;&#10;        :root {&#10;            --primary: #6366F1;&#10;            --primary-dark: #4F46E5;&#10;            --primary-light: #818CF8;&#10;            --text: #1F2937;&#10;            --text-light: #6B7280;&#10;            --bg: #F3F4F6;&#10;            --card: #FFFFFF;&#10;            --green: #10B981;&#10;            --danger: #EF4444;&#10;        }&#10;        body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: var(--bg); margin: 0; color: var(--text); }&#10;        .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }&#10;        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 1.25rem; }&#10;        .back { text-decoration:none; color: var(--primary-dark); font-weight:600; }&#10;        .card { background: var(--card); border-radius: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.08); padding: 1.25rem; margin-bottom: 1rem; }&#10;        .doctor { display:flex; align-items:center; gap: 1rem; }&#10;        .avatar { width:56px; height:56px; border-radius: 50%; background: linear-gradient(135deg,var(--primary),var(--primary-light)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:1.2rem; }&#10;        .title { font-size:1.1rem; color: var(--text-light); }&#10;        .grid { display:grid; grid-template-columns: repeat(7, 1fr); gap: .5rem; }&#10;        .dow { text-align:center; font-weight:700; color: var(--text-light); padding:.5rem 0; }&#10;        .day { background:#fff; border: 2px solid #E5E7EB; border-radius:12px; min-height:72px; padding:.5rem; position:relative; cursor: default; }&#10;        .day .num { font-weight:700; }&#10;        .day.available { border-color: var(--green); background: #ECFDF5; cursor: pointer; }&#10;        .day.selected { outline: 3px solid var(--primary-light); }&#10;        .legend { display:flex; align-items:center; gap:.75rem; color: var(--text-light); font-size:.95rem; }&#10;        .legend .box { width:14px; height:14px; border-radius:4px; background:#ECFDF5; border:2px solid var(--green); }&#10;        .cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:.75rem; }&#10;        .nav a { text-decoration:none; color:#fff; background: var(--primary); padding:.5rem .75rem; border-radius:8px; font-weight:600; }&#10;        .weekly ul { margin: .5rem 0 0 1rem; color: var(--text-light);}&#10;        .badge { display:inline-block; padding:.25rem .5rem; border-radius:8px; background: #EEF2FF; color: #3730A3; font-size:.8rem; font-weight:700; }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;container&quot;&gt;&#10;    &lt;div class=&quot;header&quot;&gt;&#10;        &lt;a class=&quot;back&quot; href=&quot;${pageContext.request.contextPath}/patient&quot;&gt;&amp;larr; Retour aux recherches&lt;/a&gt;&#10;        &lt;div class=&quot;legend&quot;&gt;&lt;span class=&quot;box&quot;&gt;&lt;/span&gt; Jours disponibles&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card doctor&quot;&gt;&#10;        &lt;div class=&quot;avatar&quot;&gt;&#10;            &lt;c:choose&gt;&#10;                &lt;c:when test=&quot;${not empty doctor.user.name}&quot;&gt;${fn:toUpperCase(fn:substring(doctor.user.name,0,1))}&lt;/c:when&gt;&#10;                &lt;c:otherwise&gt;DR&lt;/c:otherwise&gt;&#10;            &lt;/c:choose&gt;&#10;        &lt;/div&gt;&#10;        &lt;div&gt;&#10;            &lt;div style=&quot;font-size:1.25rem; font-weight:800;&quot;&gt;Dr. ${doctor.user.name}&lt;/div&gt;&#10;            &lt;div class=&quot;title&quot;&gt;${doctor.titre != null ? doctor.titre : 'Médecin'} • &lt;strong&gt;${doctor.specialite.name}&lt;/strong&gt;&lt;/div&gt;&#10;            &lt;div style=&quot;margin-top:.35rem;&quot;&gt;&lt;span class=&quot;badge&quot;&gt;Matricule: ${doctor.matricule}&lt;/span&gt;&lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card weekly&quot;&gt;&#10;        &lt;div style=&quot;font-weight:800; margin-bottom:.5rem;&quot;&gt;Créneaux hebdomadaires&lt;/div&gt;&#10;        &lt;c:choose&gt;&#10;            &lt;c:when test=&quot;${empty weekly}&quot;&gt;&#10;                &lt;div class=&quot;muted&quot;&gt;Aucune disponibilité renseignée.&lt;/div&gt;&#10;            &lt;/c:when&gt;&#10;            &lt;c:otherwise&gt;&#10;                &lt;ul&gt;&#10;                    &lt;c:forEach var=&quot;e&quot; items=&quot;${weekly}&quot;&gt;&#10;                        &lt;li&gt;&#10;                            &lt;strong&gt;${e.key}&lt;/strong&gt;:&#10;                            &lt;c:forEach var=&quot;label&quot; items=&quot;${e.value}&quot; varStatus=&quot;s&quot;&gt;&#10;                                ${label}&lt;c:if test=&quot;${!s.last}&quot;&gt;, &lt;/c:if&gt;&#10;                            &lt;/c:forEach&gt;&#10;                        &lt;/li&gt;&#10;                    &lt;/c:forEach&gt;&#10;                &lt;/ul&gt;&#10;            &lt;/c:otherwise&gt;&#10;        &lt;/c:choose&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card&quot;&gt;&#10;        &lt;div class=&quot;cal-header&quot;&gt;&#10;            &lt;div style=&quot;font-weight:800; font-size:1.1rem;&quot;&gt;${fn:toUpperCase(monthLabel)} ${year}&lt;/div&gt;&#10;            &lt;div class=&quot;nav&quot;&gt;&#10;                &lt;a href=&quot;${pageContext.request.contextPath}/patient/doctor?id=${doctor.id}&amp;year=${prevYear}&amp;month=${prevMonth}&quot;&gt;Précédent&lt;/a&gt;&#10;                &lt;a href=&quot;${pageContext.request.contextPath}/patient/doctor?id=${doctor.id}&amp;year=${nextYear}&amp;month=${nextMonth}&quot; style=&quot;margin-left:.5rem; background: var(--primary-dark);&quot;&gt;Suivant&lt;/a&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &lt;div id=&quot;calendar&quot; class=&quot;grid&quot; data-year=&quot;${year}&quot; data-month=&quot;${month}&quot; data-doctor-id=&quot;${doctor.id}&quot; data-context=&quot;${pageContext.request.contextPath}&quot;&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Lun&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Mar&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Mer&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Jeu&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Ven&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Sam&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Dim&lt;/div&gt;&#10;            &lt;!-- leading blanks --&gt;&#10;            &lt;c:forEach var=&quot;i&quot; begin=&quot;1&quot; end=&quot;${firstDow - 1}&quot;&gt;&#10;                &lt;div&gt;&lt;/div&gt;&#10;            &lt;/c:forEach&gt;&#10;            &lt;!-- days --&gt;&#10;            &lt;c:forEach var=&quot;cell&quot; items=&quot;${dayCells}&quot;&gt;&#10;                &lt;div class=&quot;day ${cell.available ? 'available' : ''}&quot;&#10;                     data-day=&quot;${cell.day}&quot;&#10;                     data-available=&quot;${cell.available}&quot;&gt;&#10;                    &lt;div class=&quot;num&quot;&gt;${cell.day}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/c:forEach&gt;&#10;            &lt;!-- trailing blanks to complete last week (optional visual balance) --&gt;&#10;            &lt;c:set var=&quot;totalCells&quot; value=&quot;${(firstDow - 1) + daysInMonth}&quot; /&gt;&#10;            &lt;c:set var=&quot;rem&quot; value=&quot;${totalCells % 7}&quot; /&gt;&#10;            &lt;c:if test=&quot;${rem != 0}&quot;&gt;&#10;                &lt;c:forEach var=&quot;i&quot; begin=&quot;1&quot; end=&quot;${7 - rem}&quot;&gt;&#10;                    &lt;div&gt;&lt;/div&gt;&#10;                &lt;/c:forEach&gt;&#10;            &lt;/c:if&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;&#10;" />
              <option name="updatedContent" value="&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&#10;&lt;%@ taglib uri=&quot;jakarta.tags.core&quot; prefix=&quot;c&quot; %&gt;&#10;&lt;%@ taglib uri=&quot;jakarta.tags.functions&quot; prefix=&quot;fn&quot; %&gt;&#10;&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;fr&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;title&gt;Disponibilités - ${doctor.user.name}&lt;/title&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;&#10;    &lt;style&gt;&#10;        :root {&#10;            --primary: #6366F1;&#10;            --primary-dark: #4F46E5;&#10;            --primary-light: #818CF8;&#10;            --text: #1F2937;&#10;            --text-light: #6B7280;&#10;            --bg: #F3F4F6;&#10;            --card: #FFFFFF;&#10;            --green: #10B981;&#10;            --danger: #EF4444;&#10;        }&#10;        body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background: var(--bg); margin: 0; color: var(--text); }&#10;        .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }&#10;        .header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 1.25rem; }&#10;        .back { text-decoration:none; color: var(--primary-dark); font-weight:600; }&#10;        .card { background: var(--card); border-radius: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.08); padding: 1.25rem; margin-bottom: 1rem; /* ensure calendar not clipped */ overflow: visible; }&#10;        .doctor { display:flex; align-items:center; gap: 1rem; }&#10;        .avatar { width:56px; height:56px; border-radius: 50%; background: linear-gradient(135deg,var(--primary),var(--primary-light)); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:1.2rem; }&#10;        .title { font-size:1.1rem; color: var(--text-light); }&#10;        .calendar-grid { display:grid; grid-template-columns: repeat(7, minmax(0,1fr)); gap: .5rem; grid-auto-flow: row; grid-auto-rows: minmax(72px, auto); }&#10;        .dow { text-align:center; font-weight:700; color: var(--text-light); padding:.5rem 0; }&#10;        .day { background:#fff; border: 2px solid #E5E7EB; border-radius:12px; min-height:72px; padding:.5rem; position:relative; cursor: default; }&#10;        .day .num { font-weight:700; }&#10;        .day.available { border-color: var(--green); background: #ECFDF5; cursor: pointer; }&#10;        .day.selected { outline: 3px solid var(--primary-light); }&#10;        .legend { display:flex; align-items:center; gap:.75rem; color: var(--text-light); font-size:.95rem; }&#10;        .legend .box { width:14px; height:14px; border-radius:4px; background:#ECFDF5; border:2px solid var(--green); }&#10;        .cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:.75rem; }&#10;        .nav a { text-decoration:none; color:#fff; background: var(--primary); padding:.5rem .75rem; border-radius:8px; font-weight:600; }&#10;        .weekly ul { margin: .5rem 0 0 1rem; color: var(--text-light);}        &#10;        .badge { display:inline-block; padding:.25rem .5rem; border-radius:8px; background: #EEF2FF; color: #3730A3; font-size:.8rem; font-weight:700; }&#10;        /* Modal */&#10;        .modal { display:none; position:fixed; inset:0; background: rgba(0,0,0,.45); z-index: 9999; }&#10;        .modal.open { display:flex; align-items:center; justify-content:center; }&#10;        .modal .content { background: #fff; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,.25); width: min(520px, 92%); max-height: 84vh; overflow:auto; }&#10;        .modal .header { display:flex; align-items:center; justify-content:space-between; padding: 1rem 1.25rem; border-bottom: 2px solid #F3F4F6; margin:0; }&#10;        .modal .body { padding: 1rem 1.25rem; }&#10;        .close { border:none; background:#F3F4F6; color:#111; border-radius:10px; padding:.4rem .6rem; cursor:pointer; }&#10;        .slots { display:flex; flex-wrap: wrap; gap: .5rem; margin-top: .5rem; }&#10;        .slot { padding: .5rem .75rem; border-radius: 10px; border: 2px solid #E5E7EB; background: #fff; cursor: pointer; font-weight: 700; }&#10;        .slot:hover { border-color: var(--primary-light); }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;container&quot;&gt;&#10;    &lt;div class=&quot;header&quot;&gt;&#10;        &lt;a class=&quot;back&quot; href=&quot;${pageContext.request.contextPath}/patient&quot;&gt;&amp;larr; Retour aux recherches&lt;/a&gt;&#10;        &lt;div class=&quot;legend&quot;&gt;&lt;span class=&quot;box&quot;&gt;&lt;/span&gt; Jours disponibles&lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card doctor&quot;&gt;&#10;        &lt;div class=&quot;avatar&quot;&gt;&#10;            &lt;c:choose&gt;&#10;                &lt;c:when test=&quot;${not empty doctor.user.name}&quot;&gt;${fn:toUpperCase(fn:substring(doctor.user.name,0,1))}&lt;/c:when&gt;&#10;                &lt;c:otherwise&gt;DR&lt;/c:otherwise&gt;&#10;            &lt;/c:choose&gt;&#10;        &lt;/div&gt;&#10;        &lt;div&gt;&#10;            &lt;div style=&quot;font-size:1.25rem; font-weight:800;&quot;&gt;Dr. ${doctor.user.name}&lt;/div&gt;&#10;            &lt;div class=&quot;title&quot;&gt;${doctor.titre != null ? doctor.titre : 'Médecin'} • &lt;strong&gt;${doctor.specialite.name}&lt;/strong&gt;&lt;/div&gt;&#10;            &lt;div style=&quot;margin-top:.35rem;&quot;&gt;&lt;span class=&quot;badge&quot;&gt;Matricule: ${doctor.matricule}&lt;/span&gt;&lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card weekly&quot;&gt;&#10;        &lt;div style=&quot;font-weight:800; margin-bottom:.5rem;&quot;&gt;Créneaux hebdomadaires&lt;/div&gt;&#10;        &lt;c:choose&gt;&#10;            &lt;c:when test=&quot;${empty weekly}&quot;&gt;&#10;                &lt;div class=&quot;muted&quot;&gt;Aucune disponibilité renseignée.&lt;/div&gt;&#10;            &lt;/c:when&gt;&#10;            &lt;c:otherwise&gt;&#10;                &lt;ul&gt;&#10;                    &lt;c:forEach var=&quot;e&quot; items=&quot;${weekly}&quot;&gt;&#10;                        &lt;li&gt;&#10;                            &lt;strong&gt;${e.key}&lt;/strong&gt;:&#10;                            &lt;c:forEach var=&quot;label&quot; items=&quot;${e.value}&quot; varStatus=&quot;s&quot;&gt;&#10;                                ${label}&lt;c:if test=&quot;${!s.last}&quot;&gt;, &lt;/c:if&gt;&#10;                            &lt;/c:forEach&gt;&#10;                        &lt;/li&gt;&#10;                    &lt;/c:forEach&gt;&#10;                &lt;/ul&gt;&#10;            &lt;/c:otherwise&gt;&#10;        &lt;/c:choose&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;card&quot;&gt;&#10;        &lt;div class=&quot;cal-header&quot;&gt;&#10;            &lt;div style=&quot;font-weight:800; font-size:1.1rem;&quot;&gt;${fn:toUpperCase(monthLabel)} ${year}&lt;/div&gt;&#10;            &lt;div class=&quot;nav&quot;&gt;&#10;                &lt;a href=&quot;${pageContext.request.contextPath}/patient/doctor?id=${doctor.id}&amp;year=${prevYear}&amp;month=${prevMonth}&quot;&gt;Précédent&lt;/a&gt;&#10;                &lt;a href=&quot;${pageContext.request.contextPath}/patient/doctor?id=${doctor.id}&amp;year=${nextYear}&amp;month=${nextMonth}&quot; style=&quot;margin-left:.5rem; background: var(--primary-dark);&quot;&gt;Suivant&lt;/a&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &lt;div id=&quot;calendar&quot; class=&quot;calendar-grid&quot; data-year=&quot;${year}&quot; data-month=&quot;${month}&quot; data-doctor-id=&quot;${doctor.id}&quot; data-context=&quot;${pageContext.request.contextPath}&quot;&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Lun&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Mar&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Mer&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Jeu&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Ven&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Sam&lt;/div&gt;&#10;            &lt;div class=&quot;dow&quot;&gt;Dim&lt;/div&gt;&#10;            &lt;!-- leading blanks --&gt;&#10;            &lt;c:forEach var=&quot;i&quot; begin=&quot;1&quot; end=&quot;${firstDow - 1}&quot;&gt;&#10;                &lt;div&gt;&lt;/div&gt;&#10;            &lt;/c:forEach&gt;&#10;            &lt;!-- days --&gt;&#10;            &lt;c:forEach var=&quot;cell&quot; items=&quot;${dayCells}&quot;&gt;&#10;                &lt;div class=&quot;day ${cell.available ? 'available' : ''}&quot;&#10;                     data-day=&quot;${cell.day}&quot;&#10;                     data-available=&quot;${cell.available}&quot;&gt;&#10;                    &lt;div class=&quot;num&quot;&gt;${cell.day}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;            &lt;/c:forEach&gt;&#10;            &lt;!-- trailing blanks to complete last week (optional visual balance) --&gt;&#10;            &lt;c:set var=&quot;totalCells&quot; value=&quot;${(firstDow - 1) + daysInMonth}&quot; /&gt;&#10;            &lt;c:set var=&quot;rem&quot; value=&quot;${totalCells % 7}&quot; /&gt;&#10;            &lt;c:if test=&quot;${rem != 0}&quot;&gt;&#10;                &lt;c:forEach var=&quot;i&quot; begin=&quot;1&quot; end=&quot;${7 - rem}&quot;&gt;&#10;                    &lt;div&gt;&lt;/div&gt;&#10;                &lt;/c:forEach&gt;&#10;            &lt;/c:if&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;!-- Modal slots --&gt;&#10;&lt;div id=&quot;slotsModal&quot; class=&quot;modal&quot; aria-hidden=&quot;true&quot;&gt;&#10;  &lt;div class=&quot;content&quot;&gt;&#10;    &lt;div class=&quot;header&quot;&gt;&#10;      &lt;div style=&quot;font-weight:800&quot;&gt;Créneaux disponibles&lt;/div&gt;&#10;      &lt;button class=&quot;close&quot; id=&quot;closeModal&quot;&gt;Fermer&lt;/button&gt;&#10;    &lt;/div&gt;&#10;    &lt;div class=&quot;body&quot;&gt;&#10;      &lt;div id=&quot;modalDate&quot; style=&quot;color: var(--text-light);&quot;&gt;&lt;/div&gt;&#10;      &lt;div id=&quot;modalSlots&quot; class=&quot;slots&quot;&gt;&lt;/div&gt;&#10;      &lt;div id=&quot;modalMsg&quot; style=&quot;margin-top:.5rem; color: var(--text-light);&quot;&gt;&lt;/div&gt;&#10;    &lt;/div&gt;&#10;  &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;script&gt;&#10;(function() {&#10;  const cal = document.getElementById('calendar');&#10;  if (!cal) return;&#10;  const year = parseInt(cal.dataset.year, 10);&#10;  const month = parseInt(cal.dataset.month, 10);&#10;&#10;  // Export des créneaux hebdo en JS&#10;  const weeklySlots = {};&#10;  &lt;c:forEach var=&quot;e&quot; items=&quot;${weekly}&quot;&gt;&#10;    weeklySlots['${e.key}'] = [&#10;      &lt;c:forEach var=&quot;label&quot; items=&quot;${e.value}&quot; varStatus=&quot;s&quot;&gt;&#10;        '${fn:trim(label)}'&lt;c:if test=&quot;${!s.last}&quot;&gt;,&lt;/c:if&gt;&#10;      &lt;/c:forEach&gt;&#10;    ];&#10;  &lt;/c:forEach&gt;&#10;&#10;  const modal = document.getElementById('slotsModal');&#10;  const closeBtn = document.getElementById('closeModal');&#10;  const modalSlots = document.getElementById('modalSlots');&#10;  const modalMsg = document.getElementById('modalMsg');&#10;  const modalDate = document.getElementById('modalDate');&#10;&#10;  function pad(n){ return (n&lt;10 ? '0':'')+n; }&#10;  function toJour(date){&#10;    // JS: 0=Dimanche..6=Samedi&#10;    const d = date.getDay();&#10;    return ['DIMANCHE','LUNDI','MARDI','MERCREDI','JEUDI','VENDREDI','SAMEDI'][d];&#10;  }&#10;  function parseTime(str){&#10;    const [h,m] = str.split(':').map(Number);&#10;    return h*60 + m;&#10;  }&#10;  function fmt(minutes){&#10;    const h = Math.floor(minutes/60); const m = minutes%60;&#10;    return pad(h)+':'+pad(m);&#10;  }&#10;  function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }&#10;  function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }&#10;  closeBtn.addEventListener('click', closeModal);&#10;  modal.addEventListener('click', (e)=&gt;{ if(e.target===modal) closeModal(); });&#10;&#10;  function buildSlots(ranges){&#10;    // ranges: array of strings 'HH:MM - HH:MM'&#10;    const set = new Set();&#10;    for(const label of ranges){&#10;      const parts = label.split('-');&#10;      if(parts.length!==2) continue;&#10;      const start = parseTime(parts[0].trim());&#10;      const end = parseTime(parts[1].trim());&#10;      if (!(end&gt;start)) continue;&#10;      for(let t=start; t+30&lt;=end; t+=30){&#10;        set.add(fmt(t));&#10;      }&#10;    }&#10;    return Array.from(set).sort();&#10;  }&#10;&#10;  cal.addEventListener('click', (e)=&gt;{&#10;    const dayEl = e.target.closest('.day.available');&#10;    if(!dayEl) return;&#10;    const day = parseInt(dayEl.dataset.day, 10);&#10;    const jsDate = new Date(year, month-1, day);&#10;    const jour = toJour(jsDate);&#10;    // Éviter ${...} dans un template literal (conflit avec EL JSP)&#10;    modalDate.textContent = &quot;Pour le &quot; + jsDate.getFullYear() + &quot;-&quot; + pad(jsDate.getMonth()+1) + &quot;-&quot; + pad(jsDate.getDate()) + &quot; (&quot; + jour + &quot;)&quot;;&#10;&#10;    const ranges = weeklySlots[jour] || [];&#10;    const slots = buildSlots(ranges);&#10;    modalSlots.innerHTML = '';&#10;    modalMsg.textContent = '';&#10;    if(slots.length===0){&#10;      modalMsg.textContent = 'Aucun créneau pour ce jour.';&#10;    } else {&#10;      for(const s of slots){&#10;        const b = document.createElement('button');&#10;        b.type='button'; b.className='slot'; b.textContent = s;&#10;        b.addEventListener('click', ()=&gt;{&#10;          document.querySelectorAll('#modalSlots .slot.selected').forEach(x=&gt;x.classList.remove('selected'));&#10;          b.classList.add('selected');&#10;          // Ici, on pourrait rediriger vers une étape de confirmation si besoin&#10;        });&#10;        modalSlots.appendChild(b);&#10;      }&#10;    }&#10;    openModal();&#10;  });&#10;})();&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>